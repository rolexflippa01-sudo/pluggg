<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PLUGG — demo</title>
<style>
  :root{--bg:#061022;--card:#071230;--accent:#7c3aed;--muted:#9aa4b2}
  *{box-sizing:border-box;font-family:Inter,system-ui,Arial;}
  body{margin:0;background:linear-gradient(180deg,#021020,#06102a);color:#e6eef8}
  .wrap{max-width:1100px;margin:20px auto;padding:16px}
  header{display:flex;justify-content:space-between;align-items:center;padding:14px;background:rgba(255,255,255,0.03);border-radius:10px}
  .logo{font-weight:800;font-size:22px}
  .tag{font-weight:600;font-size:12px;color:var(--muted);margin-left:8px}
  nav a{color:var(--muted);margin-left:12px;text-decoration:none;font-weight:700;cursor:pointer}
  section{margin-top:16px;padding:14px;border-radius:10px;background:rgba(255,255,255,0.02)}
  h2{margin:0 0 8px 0}
  h2.under{position:relative;padding-bottom:8px}
  h2.under:after{content:"";position:absolute;left:0;bottom:0;width:64px;height:4px;background:var(--accent);border-radius:4px}
  .lead{color:var(--muted);margin-bottom:10px}
  .media-box{background:#031224;border-radius:10px;padding:12px;min-height:220px;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden}
  .media-element{max-width:100%;max-height:340px;border-radius:8px;display:block}
  .caption{margin-top:10px;font-weight:700}
  .btn{padding:10px 14px;border-radius:8px;border:none;font-weight:800;cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,#ff7bd6,#7c3aed);color:#fff}
  .btn.order{background:#10b981;color:#fff}
  .btn.dull{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .product{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);text-align:center}
  .product img{max-width:100%;height:170px;object-fit:contain;border-radius:6px}
  .muted{color:var(--muted);font-size:13px}
  .hidden{display:none !important}
  table{width:100%;border-collapse:collapse;margin-top:12px;background:rgba(255,255,255,0.02);border-radius:8px;overflow:hidden}
  th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left}
  input, select{padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
  .submit{margin-top:12px;padding:12px;border-radius:8px;border:none;cursor:pointer;background:linear-gradient(90deg,#ffb86b,#ff7bd6);font-weight:800;color:#081426}
  footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
  @media (max-width:820px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <!-- Page1 -->
    <div id="page1">
      <header>
        <div><span class="logo">PLUGG</span><span class="tag">brings you smiles</span></div>
        <nav>
          <a id="navHome">HOME</a>
          <a id="navStone">STONE.X CLUB</a>
          <a id="navCatalogue">CATALOGUE</a>
          <a id="navContact">CONTACT</a>
        </nav>
      </header>

      <!-- HOME -->
      <section id="home">
        <h2 class="under">HOME</h2>
        <p class="lead">Welcome to PLUGG. Quick vibes: smile, connect, enjoy. Below are rotating visuals.</p>
        <div class="media-box" id="homeBox">
          <div id="homeMediaHolder"></div>
          <div class="caption" id="homeCaption"></div>
        </div>
      </section>

      <!-- STONE.X CLUB -->
      <section id="stone">
        <h2>STONE.X CLUB</h2>
        <p class="lead">Encouraging socialism, adventure and entertainment — join us for updates and offers.</p>
        <div class="media-box" id="stoneBox">
          <div id="stoneMediaHolder"></div>
          <div class="caption" id="stoneCaption"></div>
        </div>
        <div style="margin-top:10px;display:flex;align-items:center;gap:10px">
          <button class="btn primary" id="joinBtn">JOIN</button>
          <div class="muted">Join our Discord community.</div>
        </div>
      </section>

      <!-- CATALOGUE -->
      <section id="catalogue">
        <h2 class="under">CATALOGUE</h2>
        <p class="lead">Hit ORDER to view the product catalogue and create orders.</p>
        <button class="btn order" id="orderBtn">ORDER</button>
      </section>

      <!-- CONTACT -->
      <section id="contact">
        <h2>CONTACT</h2>
        <p class="lead">Get In Touch!</p>
        <button class="btn dull" id="adminBtn">ADMIN</button>
        <div class="muted" style="margin-top:8px">Click ADMIN to message admin on WhatsApp.</div>
      </section>
    </div>

    <!-- Page2 -->
    <div id="page2" class="hidden">
      <section>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2>PLUGG CATALOGUE</h2>
            <div class="muted">Purchase your vault</div>
          </div>
          <div>
            <button class="btn" id="backHome">Back to Home</button>
          </div>
        </div>
      </section>

      <!-- JOINTS -->
      <section>
        <h2 class="under">JOINTS</h2>
        <div class="grid" id="jointsGrid">
          <div class="product">
            <img src="https://ik.imagekit.io/d7zyoaxhs/file_00000000dda06243a84958e97fd7b773.png?updatedAt=1762685683901" alt="KING SMOKE">
            <div style="font-weight:800;margin-top:8px">KING SMOKE</div>
            <div class="muted">kes 800</div>
            <div style="margin-top:8px"><button class="btn primary add" data-id="king_smoke" data-name="KING SMOKE" data-price="800">ADD</button></div>
          </div>
          <div class="product">
            <img src="https://ik.imagekit.io/d7zyoaxhs/file_000000007ec861f993045e987a541c4d.png?updatedAt=1762685677914" alt="EXTRA SLIM">
            <div style="font-weight:800;margin-top:8px">EXTRA SLIM</div>
            <div class="muted">kes 50</div>
            <div style="margin-top:8px"><button class="btn primary add" data-id="extra_slim" data-name="EXTRA SLIM" data-price="50">ADD</button></div>
          </div>
        </div>
      </section>

      <!-- FLOWERS -->
      <section>
        <h2 class="under">FLOWERS</h2>
        <div class="grid" id="flowersGrid">
          <div class="product">
            <img src="https://ik.imagekit.io/d7zyoaxhs/file_0000000023d461fbb81af14135147144.png?updatedAt=1762685681697" alt="KUSH BAG">
            <div style="font-weight:800;margin-top:8px">KUSH BAG</div>
            <div class="muted">kes 1000</div>
            <div style="margin-top:8px"><button class="btn primary add" data-id="kush_bag" data-name="KUSH BAG" data-price="1000">ADD</button></div>
          </div>
          <div class="product">
            <img src="https://ik.imagekit.io/d7zyoaxhs/file_00000000544c61fda7329d16fd42c181.png?updatedAt=1762685677698" alt="G BAG">
            <div style="font-weight:800;margin-top:8px">G BAG</div>
            <div class="muted">kes 500</div>
            <div style="margin-top:8px"><button class="btn primary add" data-id="g_bag" data-name="G BAG" data-price="500">ADD</button></div>
          </div>
        </div>
      </section>

      <!-- EDIBLES -->
      <section>
        <h2 class="under">EDIBLES</h2>
        <div class="lead">COMING SOON</div>
        <div style="margin-top:8px"><button class="btn" id="generateForm">GENERATE FORM</button></div>
        <div id="formArea" class="hidden"></div>
      </section>

      <footer>PLUGG &middot; Demo catalogue</footer>
    </div>
  </div>

<script>
/* Robust single-file JS. Wrap everything in DOMContentLoaded */
document.addEventListener('DOMContentLoaded', function(){

  // Admin numbers
  const adminIntl = '254718518075'; // +254718518075
  const adminLocal = '0718518075';

  // Media arrays
  const homeMedia = [
    {url:'https://ik.imagekit.io/d7zyoaxhs/949782758.mp4?updatedAt=1762685514073', type:'video', caption:'quote'},
    {url:'https://ik.imagekit.io/d7zyoaxhs/657262329.jpg?updatedAt=1762680420217', type:'image', caption:'nature is good!'},
    {url:'https://ik.imagekit.io/d7zyoaxhs/894471697.mp4?updatedAt=1762685487890', type:'video', caption:'Plugg lets you connect!'},
    {url:'https://ik.imagekit.io/d7zyoaxhs/-1438847184.jpg?updatedAt=1762680420025', type:'image', caption:'plug never lets your desire down'}
  ];
  const stoneMedia = [
    {url:'https://ik.imagekit.io/d7zyoaxhs/1933269342.mp4?updatedAt=1762672633540', type:'video', caption:'join stone.x club and enjoy top offers'},
    {url:'https://ik.imagekit.io/d7zyoaxhs/820446153.jpg?updatedAt=1762672713826', type:'image', caption:"in stone.x club there's fun and updates! usiwachwe nyuma.."},
    {url:'https://ik.imagekit.io/d7zyoaxhs/-1634747361.mp4?updatedAt=1762672624190', type:'video', caption:'stone.x club creates top global entertainment'}
  ];

  // Simple page toggles
  const page1 = document.getElementById('page1');
  const page2 = document.getElementById('page2');
  function showPage(which){
    if(which === 1){ page1.classList.remove('hidden'); page2.classList.add('hidden'); window.scrollTo(0,0); }
    else { page1.classList.add('hidden'); page2.classList.remove('hidden'); window.scrollTo(0,0); }
  }

  // Nav clickable
  document.getElementById('navHome').addEventListener('click', ()=>document.getElementById('home').scrollIntoView({behavior:'smooth'}));
  document.getElementById('navStone').addEventListener('click', ()=>document.getElementById('stone').scrollIntoView({behavior:'smooth'}));
  document.getElementById('navCatalogue').addEventListener('click', ()=>document.getElementById('catalogue').scrollIntoView({behavior:'smooth'}));
  document.getElementById('navContact').addEventListener('click', ()=>document.getElementById('contact').scrollIntoView({behavior:'smooth'}));

  // Buttons
  document.getElementById('orderBtn').addEventListener('click', ()=>showPage(2));
  document.getElementById('backHome').addEventListener('click', ()=>showPage(1));
  document.getElementById('joinBtn').addEventListener('click', ()=>window.open('https://discord.gg/cAkuysxSn','_blank'));
  document.getElementById('adminBtn').addEventListener('click', ()=>{
    const text = encodeURIComponent('Hello Admin, I would like to enquire.');
    window.open(https://wa.me/${adminIntl}?text=${text},'_blank');
  });

  // Media shufflers - robust with fallback
  function initShuffler(holderId, captionId, items, interval){
    const holder = document.getElementById(holderId);
    const cap = document.getElementById(captionId);
    let i = 0;
    function render(){
      holder.innerHTML = '';
      cap.textContent = '';
      const it = items[i];
      if(!it) return;
      if(it.type === 'video'){
        const v = document.createElement('video');
        v.src = it.url;
        v.className = 'media-element';
        v.autoplay = true;
        v.muted = true;
        v.playsInline = true;
        v.loop = false;
        v.controls = true;
        v.setAttribute('playsinline','');
        v.addEventListener('error', ()=>{ holder.innerHTML = '<div class="muted">Video failed to load</div>'; });
        holder.appendChild(v);
        // try to play (some browsers block autoplay; muted should allow)
        v.play().catch(()=>{ /* ignore */ });
      } else {
        const img = document.createElement('img');
        img.src = it.url;
        img.alt = it.caption || '';
        img.className = 'media-element';
        img.addEventListener('error', ()=>{ holder.innerHTML = '<div class="muted">Image failed to load</div>'; });
        holder.appendChild(img);
      }
      cap.textContent = it.caption || '';
      i = (i + 1) % items.length;
    }
    render();
    return setInterval(render, interval);
  }

  // Setup shufflers
  const hm = initShuffler('homeMediaHolder','homeCaption',homeMedia,5000);
  const sm = initShuffler('stoneMediaHolder','stoneCaption',stoneMedia,7000);

  // Cart logic
  let cart = {}; // id -> { id, name, price, qty }
  function addToCart(id,name,price){
    price = Number(price);
    if(cart[id]) cart[id].qty++;
    else cart[id] = { id, name, price, qty:1 };
    // quick UI feedback
    const btns = document.querySelectorAll('.add');
    btns.forEach(b=>{ if(b.dataset.id === id){ b.textContent='ADDED'; b.disabled=true; setTimeout(()=>{ b.textContent='ADD'; b.disabled=false; },900); }});
  }

  // Delegate add button clicks
  document.body.addEventListener('click', function(e){
    const t = e.target;
    if(t.classList.contains('add')){
      const id = t.dataset.id, name = t.dataset.name, price = t.dataset.price;
      addToCart(id,name,price);
    }
  });

  // GENERATE FORM button
  document.getElementById('generateForm').addEventListener('click', function(){
    const area = document.getElementById('formArea');
    area.classList.remove('hidden');
    area.innerHTML = ''; // reset

    // Table
    const table = document.createElement('table');
    table.innerHTML = '<thead><tr><th>Product</th><th>Qty</th><th>Unit</th><th>Total</th></tr></thead>';
    const tbody = document.createElement('tbody');

    // If cart empty: show empty placeholder rows
    if(Object.keys(cart).length === 0){
      // 2 placeholders
      for(let j=0;j<2;j++){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><input class="inp-name" type="text" placeholder="product name"></td>
                        <td><input class="inp-qty" type="number" min="0" value="0"></td>
                        <td><input class="inp-unit" type="number" min="0" value="0"></td>
                        <td class="row-total">kes 0</td>`;
        tbody.appendChild(tr);
      }
    } else {
      // populate from cart
      for(const k in cart){
        const it = cart[k];
        const tr = document.createElement('tr');
        tr.dataset.pid = it.id;
        tr.innerHTML = `<td class="prod-name">${escapeHtml(it.name)}</td>
                        <td><input class="inp-qty" type="number" min="0" value="${it.qty}" data-price="${it.price}"></td>
                        <td class="unit-cell">kes ${it.price}</td>
                        <td class="row-total">kes ${it.qty * it.price}</td>`;
        tbody.appendChild(tr);
      }
    }
    table.appendChild(tbody);
    area.appendChild(table);

    // Other fields
    const fields = document.createElement('div');
    fields.style.marginTop = '10px';
    fields.innerHTML = `
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <div style="flex:1;min-width:180px"><label class="muted">Code name</label><input id="codeName" type="text" placeholder="Nyalibro#"></div>
        <div style="flex:1;min-width:180px"><label class="muted">Contact</label><input id="contact" type="tel" placeholder="0714410573"></div>
      </div>
      <div style="display:flex;gap:10px;margin-top:8px;flex-wrap:wrap">
        <div style="flex:1;min-width:180px"><label class="muted">Location</label>
          <select id="locPrimary"><option value="">-- choose --</option><option value="Tudor">Tudor</option><option value="Lights">Lights</option></select>
        </div>
        <div style="flex:1;min-width:180px"><label class="muted">Zone</label>
          <select id="locSub"><option value="">-- pick area first --</option></select>
        </div>
      </div>
    `;
    area.appendChild(fields);

    // Submit
    const submitDiv = document.createElement('div');
    submitDiv.innerHTML = <button class="submit" id="submitOrder">SUBMIT</button>;
    area.appendChild(submitDiv);

    // Wire qty changes
    area.querySelectorAll('.inp-qty').forEach(inp=>{
      inp.addEventListener('input', function(){
        const row = this.closest('tr');
        const p = Number(this.dataset.price) || 0;
        const q = Number(this.value) || 0;
        const totCell = row.querySelector('.row-total');
        if(totCell) totCell.textContent = 'kes ' + (p * q);
        updateGrand(table, area);
      });
    });

    // If placeholder rows exist, wire their qty/unit/name
    area.querySelectorAll('tr').forEach(tr=>{
      const qty = tr.querySelector('.inp-qty');
      const unit = tr.querySelector('.inp-unit');
      const name = tr.querySelector('.inp-name');
      if(qty && unit){
        qty.addEventListener('input', ()=>{ const q=Number(qty.value)||0; const u=Number(unit.value)||0; tr.querySelector('.row-total').textContent='kes '+(q*u); updateGrand(table, area); });
        unit.addEventListener('input', ()=>{ const q=Number(qty.value)||0; const u=Number(unit.value)||0; tr.querySelector('.row-total').textContent='kes '+(q*u); updateGrand(table, area); });
        name && name.addEventListener('input', ()=>{}); // no-op but ensures responsiveness
      }
    });

    // Location cascade
    const primary = document.getElementById('locPrimary'), sub = document.getElementById('locSub');
    primary.addEventListener('change', function(){
      sub.innerHTML = '';
      if(this.value === 'Tudor'){ ['Bakstan','TUM'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; sub.appendChild(o); }); }
      else if(this.value === 'Lights'){ ['Jocham','China square'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; sub.appendChild(o); }); }
      else { const o=document.createElement('option'); o.textContent='-- pick area first --'; sub.appendChild(o); }
    });

    // Final submit click
    document.getElementById('submitOrder').addEventListener('click', function(){
      const codeName = (document.getElementById('codeName').value || 'Nyalibro#').trim();
      const contact = (document.getElementById('contact').value || '').trim();
      const areaVal = primary.value || '';
      const zoneVal = sub.value || '';

      // read rows and build message
      const rows = table.querySelectorAll('tbody tr');
      let lines = [];
      let total = 0;
      rows.forEach(r=>{
        // if cart populated row — has .prod-name OR placeholder inputs
        const prodCell = r.querySelector('.prod-name');
        if(prodCell){
          const pname = prodCell.textContent.trim();
          const qty = Number(r.querySelector('.inp-qty').value) || 0;
          const unit = Number(r.querySelector('.inp-qty').dataset.price) || 0;
          if(qty>0 && pname){ lines.push(${qty} ${pname} @${unit}); total += qty*unit; }
        } else {
          const nameI = r.querySelector('.inp-name');
          const qtyI = r.querySelector('.inp-qty');
          const unitI = r.querySelector('.inp-unit');
          if(!nameI || !qtyI || !unitI) return;
          const pname = (nameI.value || '').trim();
          const qty = Number(qtyI.value) || 0;
          const unit = Number(unitI.value) || 0;
          if(qty>0 && pname){ lines.push(${qty} ${pname} @${unit}); total += qty*unit; }
        }
      });

      if(lines.length === 0){
        alert('Please add at least one product with quantity > 0.');
        return;
      }

      // Compose message as requested
      let message = ${codeName}\n;
      lines.forEach(l=> message += l + '\n');
      message += Total kes${total}\n;
      if(areaVal){
        message += (areaVal + (zoneVal ? ', ' + zoneVal : '')) + '\n';
      }
      if(contact) message += contact + '\n';

      // Open WhatsApp (user must press send)
      const url = https://wa.me/${adminIntl}?text=${encodeURIComponent(message)};
      window.open(url, '_blank');
    });

    updateGrand(table, area);
  });

  // helper: update grand total display
  function updateGrand(table, area){
    let total = 0;
    table.querySelectorAll('.row-total').forEach(td=>{
      const txt = (td.textContent||'').replace(/[^0-9]/g,'');
      total += Number(txt) || 0;
    });
    let el = area.querySelector('.grand');
    if(!el){ el = document.createElement('div'); el.className='grand'; el.style.marginTop='8px'; area.appendChild(el); }
    el.innerHTML = <div class="muted">Total: <strong>kes ${total}</strong></div>;
  }

  // small utility
  function escapeHtml(s){ return